@page "/calendar"
@using StudySprout.DatabaseData
@inject StudyCalendarEdit CalendarService

<h1>Study Calendar</h1>

<div class="calendar">

    <div class="header">
        <button @onclick="PreviousMonth">‹</button>
        <h2>@GetMonthName(currentMonth) @currentYear</h2>
        <button @onclick="NextMonth">›</button>
    </div>

    <div class="day-labels">
        <div>Sun</div>
        <div>Mon</div>
        <div>Tue</div>
        <div>Wed</div>
        <div>Thu</div>
        <div>Fri</div>
        <div>Sat</div>
    </div>

    <div class="days">
        @for (int i = 0; i < FirstDayOfWeek; i++)
        {
            <div class="day blank"></div>
        }

        @foreach (var day in Enumerable.Range(1, DaysInMonth))
        {
            var date = new DateTime(currentYear, currentMonth, day);
            var events = CalendarService.GetAllTimes()
                .Where(e => e.StartDate.Date == date.Date)
                .ToList();

            <div class="day">
                <strong>@day</strong>
                @foreach (var ev in events)
                {
                    <div class="event @ev.Category.ToLower()">@ev.Title</div>
                }
            </div>
        }
    </div>
</div>

@code {
    private int currentMonth = 4; // April
    private int currentYear = 2025;

    private int DaysInMonth => DateTime.DaysInMonth(currentYear, currentMonth);
    private int FirstDayOfWeek => (int)new DateTime(currentYear, currentMonth, 1).DayOfWeek;

    private void PreviousMonth()
    {
        currentMonth--;
        if (currentMonth < 1)
        {
            currentMonth = 12;
            currentYear--;
        }

        StateHasChanged();
    }

   private void NextMonth()
{
    Console.WriteLine("NextMonth clicked!");
    currentMonth++;
    if (currentMonth > 12)
    {
        currentMonth = 1;
        currentYear++;
    }

    StateHasChanged();
}


    private string GetMonthName(int month)
    {
        return new DateTime(currentYear, month, 1).ToString("MMMM");
    }

    protected override void OnInitialized()
    {
        if (!CalendarService.GetAllTimes().Any())
        {
            CalendarService.AddSampleData();
        }
    }
}


